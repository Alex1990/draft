<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Step</title>
    <style>
        body {
            margin: 0;
            font: 100% sans-serif;
        }
        .cf:after {
            content: ' ';
            height: 0;
            visibility: hidden;
            display: block;
            clear: both;
        }
        .cf {
            zoom: 1;
        }
        .step-wrapper {
            width: 600px;
        }
        .step-wrapper .step-header {
            list-style: none;
            margin: 0;
            padding: 0;
            width: 100%;
        }
        .step-wrapper .step-header-item {
            float: left;
            padding: 10px 20px;
            font-size: 24px;
            text-align: center;
            color: #666;
        }
        .step-wrapper .step-header .activated {
            color: #000;
        }
        .step-wrapper .step-header .active {
            color: #0af;
        }
        .step-wrapper .step-body .step-body-item {
            display: none;
            height: 300px;
            padding: 20px;
        }
        .step-wrapper .step-body .active {
            display: block;
        }
        .step-wrapper .step-footer {
            padding: 20px 15px 20px 0;
            text-align: right;
            background-color: #f4f4f4;
            cursor: default;
        }
        .step-wrapper .step-footer .step-btn {
            display: inline-block;
            margin-right: 5px;
            height: 30px;
            padding: 0 15px;
            font-size: 16px;
            line-height: 30px;
            text-decoration: none;
            background-color: #fafafa;
            color: #555;
            border: 1px solid #ddd;
        }
        .step-wrapper .step-footer .step-btn:hover {
            color: #000;
            border-color: #d0d0d0;
            box-shadow: 0 1px 2px -1px #ccc;
        }
    </style>
</head>
<body>
    <div id="brand-step" class="step-wrapper">
        <ul class="step-header cf">
            <li class="step-header-item active" data-body="#step1">First</li>
            <li class="step-header-item" data-body="#step2">Second</li>
            <li class="step-header-item" data-body="#step3">Third</li>
        </ul>
        <div class="step-body">
            <div id="step1" class="step-body-item active">
                <p>This is the first.</p>
            </div>
            <div id="step2" class="step-body-item">
                <p>This is the second.</p>
            </div>
            <div id="step3" class="step-body-item">
                <p>This is the third.</p>
            </div>
        </div>
        <div class="step-footer">
            <a href="javascript:void(0)" class="step-btn step-cancel">取消</a>
            <a href="javascript:void(0)" class="step-btn step-prev">上一步</a>
            <a href="javascript:void(0)" class="step-btn step-next">下一步</a>
            <a href="javascript:void(0)" class="step-btn step-finish">完成</a>
        </div>
    </div>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
    <script>
        /**
         * name: ui.widget.step.js
         * description: 主要用于显示步骤引导层，就是刚开始显示某个步骤，然后点击下一步显示下个步骤内容
         * author: Alex Chao <8914@jobcn.com>
         * example:
         *  // html结构
         *  <div id="brand-step" class="step-wrapper">
         *      <ul class="step-header cf">
         *          <li class="step-header-item active" data-body="#step1">First</li>
         *          <li class="step-header-item" data-body="#step2">Second</li>
         *          <li class="step-header-item" data-body="#step3">Third</li>
         *      </ul>
         *      <div class="step-body">
         *          <div id="step1" class="step-body-item active"><p>This is the first.</p></div>
         *          <div id="step2" class="step-body-item"><p>This is the second.</p></div>
         *          <div id="step3" class="step-body-item"><p>This is the third.</p></div>
         *      </div>
         *      <div class="step-footer">
         *          <a href="javascript:void(0)" class="step-btn step-cancel">取消</a>
         *          <a href="javascript:void(0)" class="step-btn step-prev">上一步</a>
         *          <a href="javascript:void(0)" class="step-btn step-next">下一步</a>
         *          <a href="javascript:void(0)" class="step-btn step-finish">完成</a>
         *      </div>
         *  </div>
         *  
         *  // 调用
         *  // 如果想要显示在一个弹出的窗口中，还需要类似ui.box弹出框插件
         *  var Step = require('ui.widget.step');
         *  // step已经存在于$.fn上面
         *  $('#brand-step').step({
         *      showPrev: false,
         *      activatedCls: 'after_setup',
         *      oncancel: function(index) {
         *      },
         *      onfinish: function(index) {
         *      }
         *  });
        */

        (function() {
            // 默认配置
            var defaults = {
                el             : '',
                effect         : 'none',             // 每个步骤内容切换效果，目前只支持'none'
                duration       : 400,                // effect为'vslide'/'hslide'时的动画持续时间
                startAt        : 0,                  // 从第几步开始，从0开始计数
                showCancel     : true,               // 是否显示取消按钮
                showPrev       : true,               // 是否显示上一步按钮，第一步时不显示
                showNext       : true,               // 是否显示下一步按钮，最后一步时不显示
                showFinish     : false,              // 是否每一步都显示完成按钮，最后一步必显示
                activatedCls   : 'activated',        // 正在设置步骤之前的所有步骤
                activeCls      : 'active',           // 正在设置步骤
                onprev         : function(index) {}, // 开始切换到上一步时，执行此回调
                onnext         : function(index) {}, // 开始切换到下一步时，执行此回调
                oncancel       : function(index) {}, // 点击取消按钮时，执行此回调，index 参数表示第几步（从0开始计数）
                onfinish       : function(index) {}, // 点击完成按钮时，执行此回调，index 参数表示第几步（从0开始计数）
                onbeforeprev   : function(index) {}, // 切换到上一步之前，执行此回调，可用来执行本步骤验证
                onbeforenext   : function(index) {}  // 切换到下一步之前，执行此回调，可用来执行本步骤验证
            };

            // 构造函数
            function Step(opts) {
                // 合并配置
                opts = this.opts = $.extend({}, defaults, opts);

                if (!opts.el) {
                    throw 'Need the selector';
                }

                this.$el = $(opts.el);

                this.btns = {
                    cancel : this.$el.find('.step-footer .step-cancel'),
                    prev   : this.$el.find('.step-footer .step-prev'),
                    next   : this.$el.find('.step-footer .step-next'),
                    finish : this.$el.find('.step-footer .step-finish')
                };

                // 控制按钮是否可用
                this.prevEnabled = this.nextEnabled = true;

                this.index = opts.startAt;
                this.totalCount = this.$el.find('.step-header-item').length;

                this.init();
            }

            // 所有原型属性或方法
            $.extend(Step.prototype, {

                init: function() {
                    var $stepBody = this.$el.find('.step-body');

                    this.stepBodyWidth = $stepBody.width();

                    $stepBody.css({
                        position: 'relative',
                        width: this.stepBodyWidth,
                        height: $stepBody.height(),
                        overflow: 'hidden'
                    });

                    $stepBody.find('.step-body-item').css({
                        position: 'absolute',
                        top: 0,
                        left: 0,
                        width: '100%'
                    });

                    this.initButtons();
                    this.bindEvents();
                },

                // 根据配置显示按钮
                initButtons: function() {
                    if (!this.opts.showCancel) {
                        this.btns.cancel.remove();
                    }
                    if (!this.opts.showPrev) {
                        this.btns.prev.remove();
                    }

                    this.gotoStep(this.index);
                },

                // 为控制按钮绑定事件
                bindEvents: function() {
                    var self = this;

                    self.$el
                        .delegate('.step-footer .step-cancel', 'click', function(){
                            self.cancel();
                        })
                        .delegate('.step-footer .step-finish', 'click', function(){
                            self.finish();
                        })
                        .delegate('.step-footer .step-prev', 'click', function(){
                            self.opts.onbeforeprev();
                            self.prevEnabled && self.prev();
                        })
                        .delegate('.step-footer .step-next', 'click', function(){
                            self.opts.onbeforenext();
                            self.nextEnabled && self.next();
                        });
                },

                // 返回当前第几步（从0开始计数）
                index: function() {
                    return this.index;
                },

                // 跳转到第 index 步
                gotoStep: function(index) {

                    this.index = index;

                    var $activeHeader = this.$el.find('.step-header-item').eq(index),
                        $activeBody   = $($activeHeader.data('body'));

                    var effect = this.sequence ? this.opts.effect : 'none';

                    this.effectExecutors[effect].call(this, $activeHeader, $activeBody);

                    if (index <= 0) {
                        this.btns.prev.hide();
                    } else {
                        this.btns.prev.show();
                    }

                    if (index >= this.totalCount - 1) {
                        this.btns.next.hide();
                        this.btns.finish.show();
                    } else {
                        this.btns.next.show();
                        this.btns.finish.hide();
                    }

                    if (this.opts.showFinish) {
                        this.btns.finish.show();
                    }
                },

                // 跳转到上一步
                prev: function() {
                    if (this.index > 0) {
                        this.index--;
                        this.sequence = 'prev';
                        this.gotoStep(this.index);
                    }
                    this.opts.onprev();
                },

                // 跳转到下一步
                next: function() {
                    if (this.index < this.totalCount - 1) {
                        this.index++;
                        this.sequence = 'next';
                        this.gotoStep(this.index);
                    }
                    this.opts.onnext();
                },

                // 取消
                cancel: function() {
                    this.opts.oncancel.call(this, this.index);
                },

                // 完成
                finish: function() {
                    this.opts.onfinish.call(this, this.index);
                },

                // 切换class，当前步骤添加activeCls类，当前步骤之前的步骤添加activatedCls类
                activeClass: function($activeHeader, $activeBody) {

                    var activeCls    = this.opts.activeCls,
                        activatedCls = this.opts.activatedCls;

                    $activeHeader.siblings('.step-header-item').removeClass(activeCls + ' ' + activatedCls)
                        .end().addClass(activeCls).removeClass(activatedCls)
                        .prevAll('.step-header-item').addClass(activatedCls);

                    $activeBody.siblings('.step-body-item').removeClass(activeCls + ' ' + activatedCls)
                        .end().addClass(activeCls).removeClass(activatedCls)
                        .prevAll('.step-body-item').addClass(activatedCls);
                },

                // 切换步骤时，切换效果执行器，可扩展，执行完成后切换class
                effectExecutors: {

                    // 无任何动画效果，仅仅时切换class控制显示与隐藏
                    none: function($activeHeader, $activeBody) {
                        this.activeClass($activeHeader, $activeBody);
                    },

                    // 水平方向滑动切入切出效果
                    slide: function($activeHeader, $activeBody) {
                        var self = this,
                            sequenceMap = {
                                prev: {
                                    left: -self.stepBodyWidth,
                                    $el: $activeBody.next('.step-body-item')
                                },
                                next: {
                                    left: self.stepBodyWidth,
                                    $el: $activeBody.prev('.step-body-item')
                                }
                            };

                            $activeBody.css({
                                    left: sequenceMap[self.sequence].left
                                })
                                .show()
                                .animate({
                                    left: 0
                                }, self.opts.duration, function() {
                                    $activeBody.hide();
                                    self.activeClass($activeHeader, $activeBody);
                                });

                            sequenceMap[self.sequence].$el
                                .animate({
                                    left: -sequenceMap[self.sequence].left
                                }, self.opts.duration);
                    }
                }
            });

            var noConflict = $.fn.step;

            // 写到jQuery原型上，方便调用
            $.fn.step = function(opts) {
                opts = $.extend({el: this}, opts);
                return new Step(opts);
            };

            // 原先的$.fn.step，不过没发现什么插件或方法占用了$.fn.step
            $.fn.step.noConflict = noConflict;

        })();

        $(function() {
            $('#brand-step').step({
                effect: 'slide'
            });
        });
    </script>
</body>
</html>
