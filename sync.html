<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title></title>
    <style>
        body {
            margin: 0;
            font: 16px Arial, Microsoft Yahei, sans-serif;
        }
        .select-trigger {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            text-decoration: none;
            color: #555;
            border: 1px solid #ddd;
        }

        .slidepicker {
            float: left;
            width: 50%;
            height: 160px;
            overflow: hidden;
            position: relative;
        }
        .slidepicker-list {
            position: absolute;
            list-style: none;
            margin: 0;
            padding: 0;
            width: 100%;
        }
        .slidepicker-list li {
            font-size: 18px;
            line-height: 32px;
            text-align: center;
            color: #444;
        }
        .slidepicker-list .slidepicker-current {
            font-weight: 700;
            color: #0af;
        }
        .slidepicker-current-frame {
            position: absolute;
            top: 64px;
            width: 100%;
            height: 30px;
            background-color: rgba(0,160,255,.05);
            border-top: 1px solid #cef;
            border-bottom: 1px solid #cdf;
        }
        .slidepicker-unit {
            position: absolute;
            top: 64px;
            right: 5px;
            height: 32px;
            line-height: 32px;
        }
    </style>
</head>
<body>
    <div>
        <a class="select-trigger" href="javascript:;">Select</a>
    </div>
    <div id="slidepicker-demo"></div>
    <script src="../../jslib/zepto/1.1.3/zepto.js"></script>
    <script>
        ;(function(win, undefined){

            // Default settings
            var settings = {
                wrapper: null,
                count: 1,
                showNumber: 5,
                items: [],
                defaultValue: null,
                unitText: ''
            }

            // Constructor
            function SlidePicker(opts) {
                opts = $.extend(settings, opts);

                this.wrapper = opts.wrapper ? $(opts.wrapper) : $('<div></div>');

                if (opts.wrapper) {
                    this.wrapper = $(opts.wrapper);
                } else {
                    this.wrapper = $('<div></div>');
                    this.wrapper.appendTo($(document.body));
                }
                this.wrapper.addClass('slidepicker-wrapper');

                this.pickers = [];
                this.sideNum = (opts.showNumber - 1)/2;

                this.initTpl(opts);
                this.initPos();
                this.initEvents();
            };

            // Initialize the html of all pickers
            SlidePicker.prototype.initTpl = function(opts){
                if (opts.count === 1) {
                    this.pickers[0] = slidepickerTpl({
                        items: opts.items,
                        defaultValue: opts.defaultValue,
                        unitText: opts.unitText
                    });
                } else if (opts.count > 1) {
                    for (var i = 0; i < opts.count; i++) {
                        this.pickers[i] = slidepickerTpl({
                            items: opts.data[i],
                            defaultValue: opts.defaultValue[i],
                            unitText: opts.unitText[i]
                        });
                    }
                }

                this.wrapper.append(this.pickers.join('\n'));
            };

            // Move the slidepickers to the current selected item
            SlidePicker.prototype.initPos = function(){
                var sideNum = this.sideNum;
                this.wrapper.find('.slidepicker-list').each(function(index, list){
                    $list = $(list);
                    var curIdx = $list.find('.slidepicker-current').index(),
                        itemHeight = $list.find('li').height();

                    $list.css('top', (-itemHeight * curIdx + sideNum * itemHeight) + 'px');
                });
            };

            // Bind the events
            SlidePicker.prototype.initEvents = function(opts){
                var y1, y2, diffY,
                    $list,
                    listTop,
                    listHeight,
                    itemHeight,
                    sideNum = this.sideNum;

                this.wrapper
                    .on('touchstart', '.slidepicker', function(e){
                        y1 = e.touches[0].clientY;
                        $list = $(this).find('.slidepicker-list');
                        listTop1 = parseInt($list.css('top'), 10);
                        listHeight = $list.height();
                        itemHeight = $list.find('li').height();
                    })
                    .on('touchmove', '.slidepicker', function(e){

                        e.preventDefault();
                        y2 = e.changedTouches[0].clientY;
                        diffY = y2 - y1;
                        y1 = y2;

                        listTop = parseInt($list.css('top'), 10);

                        curIdx = sideNum - Math.round(listTop/itemHeight);
                        if (curIdx != $list.find('.slidepicker-current').index()) {
                            $list.find('li').eq(curIdx)
                                .addClass('slidepicker-current')
                                .siblings().removeClass('slidepicker-current');
                        }

                        listTop = listTop + diffY;

                        if (listTop >= sideNum * itemHeight) {
                            listTop = sideNum * itemHeight;
                        } else if (listTop <= (sideNum + 1) * itemHeight - listHeight) {
                            listTop = (sideNum + 1) * itemHeight - listHeight;
                        }
                        $list.css('top', listTop + 'px');
                    })
                    .on('touchend', '.slidepicker', function(e){
                        var finalListTop = Math.round(listTop/itemHeight) * itemHeight;

                        curIdx = sideNum - Math.round(finalListTop/itemHeight);
                        if (curIdx != $list.find('.slidepicker-current').index()) {
                            $list.find('li').eq(curIdx)
                                .addClass('slidepicker-current')
                                .siblings().removeClass('slidepicker-current');
                        }

                        diffTop = finalListTop - listTop;

                        for (var i = 1; i <= 20; i++) {
                            (function(){
                                var j = i;
                                setTimeout(function(){
                                    $list.css('top', (listTop + diffTop *  Math.sqrt(j/20)) + 'px');
                                }, j * 15);
                            })();
                        }
                    });
            };

            // Show the slidepicker
            SlidePicker.prototype.open = function(properties, duration, easing, callback) {
                if (arguments.length == 0) {
                    this.wrapper.show();
                } else {
                    this.wrapper.animate.apply(this.wrapper, arguments);
                }
            };

            // Hide the slidepicker
            SlidePicker.prototype.close = function(properties, duration, easing, callback) {
                if (arguments.length == 0) {
                    this.wrapper.hide();
                } else {
                    this.wrapper.animate.apply(this.$el, arguments);
                }
            };

            // A slidepicker template render function
            function slidepickerTpl(data){
                var html = '';

                html += '<div class="slidepicker">' +
                        '   <ul class="slidepicker-list">';

                for (var i = 0, len = data.items.length; i < len; i++) {
                    data.items[i] = Array.isArray(data.items[i]) ? data.items[i] : [i, data.items[i]];

                    html += '<li';
                    if (data.defaultValue == data.items[i][0]) {
                        html += ' class="slidepicker-current"';
                    }
                    html += ' data-value="' + data.items[i][0] + '">' + data.items[i][1] + '</li>';
                }
                html += '</ul>' +
                        '<div class="slidepicker-current-frame"></div>';

                html += '<div class="slidepicker-unit">' +
                        data.unitText +
                        '</div></div>';

                return html;
            }

            win.SlidePicker = SlidePicker;

        })(window);

        var slidepicker = new SlidePicker({
            wrapper: '#slidepicker-demo',
            count: 2,
            data: [
                ['item 1', 'item 2', 'item 3', 'item 4', 'item 5'],
                ['item 1', 'item 2', 'item 3', 'item 4', 'item 5', 'item 6', 'item 7']
            ],
            defaultValue: [1, 4],
            unitText: ['Unit1', 'Unit2']
        });

        slidepicker.open();

    </script>
</body>
</html>
